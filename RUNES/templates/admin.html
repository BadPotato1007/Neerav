<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <style>
      @font-face {
        font-family: 'norse';
        src: url('/static/fonts/norse.otf') format('opentype');
      }

      body {
        background: linear-gradient(135deg, rgba(75, 0, 130, 0.8), rgba(0, 0, 255, 0.5));
        font-family: 'Quicksand', sans-serif;
        background-attachment: fixed;
        background-image: url('https://i.ibb.co/9mf6y34K/1111-Photoroom.png');
        background-size: cover;
        background-position: center;
      }

      .frosted {
        backdrop-filter: blur(70px);
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .frostednav {
        backdrop-filter: blur(70px);
        background: rgba(255, 255, 255, 0.1);
      }

      .customfont {
        font-family: 'norse', sans-serif;
      }

      /* Dropdown fix */
      .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        margin-top: 0.5rem;
        min-width: 10rem;
        border-radius: 0.5rem;
        backdrop-filter: blur(70px);
        background: rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.2);
        z-index: 50;
      }

      .dropdown-content a {
        color: white;
        padding: 0.5rem 1rem;
        display: block;
        text-decoration: none;
      }

      .dropdown-content a:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .dropdown:hover .dropdown-content {
        display: block;
      }
    </style>
  </head>

  <body class="flex flex-col items-center min-h-screen">
    <!-- Navbar -->
    <nav class="w-full px-6 py-2 flex justify-between items-center fixed top-0 frostednav shadow-md z-50">
      <div class="flex items-center space-x-4">
        <img src="https://i.ibb.co/F1CK3wq/logo.png" alt="Runes Logo" class="w-12 h-12 shadow-md" />
        <span class="text-3xl text-white customfont">R U N E S</span>
      </div>
      <div class="dropdown relative">
        <button class="text-white font-bold px-4 py-2 rounded focus:outline-none">
          Admin ▾
        </button>
        <div class="dropdown-content">
          <a href="/admin">Manage Questions</a>
          <a href="/leaderboard">Leaderboard</a>
          <a href="/logout">Logout</a>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <div class="mt-28 w-full max-w-5xl p-8 frosted text-white">
      <h2 class="text-2xl font-bold text-center mb-6">Admin Panel – Manage Questions</h2>

      <!-- Add Question Form -->
      <form id="questionForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
        <input type="hidden" id="questionId" />
        <div>
          <label>Subject</label>
          <select id="sub" required class="w-full p-2 rounded bg-white bg-opacity-10 text-white">
            <option value="Physics">Physics</option>
            <option value="Chemistry">Chemistry</option>
            <option value="Maths">Maths</option>
          </select>
        </div>
        <div>
          <label>Q.No</label>
          <input type="number" id="qno" required class="w-full p-2 rounded bg-white bg-opacity-10 text-white" />
        </div>
        <div class="md:col-span-2">
          <label>Question</label>
          <textarea id="question_text" required class="w-full p-2 rounded bg-white bg-opacity-10 text-white"></textarea>
        </div>
        <div><label>A</label><input type="text" id="option_a" required class="w-full p-2 rounded bg-white bg-opacity-10 text-white" /></div>
        <div><label>B</label><input type="text" id="option_b" required class="w-full p-2 rounded bg-white bg-opacity-10 text-white" /></div>
        <div><label>C</label><input type="text" id="option_c" required class="w-full p-2 rounded bg-white bg-opacity-10 text-white" /></div>
        <div><label>D</label><input type="text" id="option_d" required class="w-full p-2 rounded bg-white bg-opacity-10 text-white" /></div>
        <div>
          <label>Correct Option</label>
          <select id="correct_option" required class="w-full p-2 rounded bg-white bg-opacity-10 text-white">
            <option value="A">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <button type="submit" class="w-full py-2 rounded bg-purple-600 hover:bg-purple-700 transition text-white font-bold">
            Save Question
          </button>
        </div>
      </form>

      <!-- Questions Table -->
      <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse text-white">
          <thead>
            <tr class="bg-purple-700 bg-opacity-50">
              <th class="p-2">ID</th>
              <th class="p-2">Subject</th>
              <th class="p-2">Q.No</th>
              <th class="p-2">Question</th>
              <th class="p-2">Actions</th>
            </tr>
          </thead>
          <tbody id="questionsTable"></tbody>
        </table>
      </div>
    </div>

    <script>
      async function loadQuestions() {
        const res = await fetch('/api/questions');
        const questions = await res.json();
        const table = document.getElementById('questionsTable');
        table.innerHTML = '';
        questions.forEach(q => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="p-2">${q.id}</td>
            <td class="p-2">${q.sub}</td>
            <td class="p-2">${q.qno}</td>
            <td class="p-2">${q.question_text}</td>
            <td class="p-2">
              <button onclick="editQuestion(${q.id})" class="bg-blue-600 px-2 py-1 rounded">Edit</button>
              <button onclick="deleteQuestion(${q.id})" class="bg-red-600 px-2 py-1 rounded">Delete</button>
            </td>
          `;
          table.appendChild(row);
        });
      }

      async function editQuestion(id) {
        const res = await fetch('/api/questions');
        const questions = await res.json();
        const q = questions.find(q => q.id === id);
        if (!q) return;

        document.getElementById('questionId').value = q.id;
        document.getElementById('sub').value = q.sub;
        document.getElementById('qno').value = q.qno;
        document.getElementById('question_text').value = q.question_text;
        document.getElementById('option_a').value = q.option_a;
        document.getElementById('option_b').value = q.option_b;
        document.getElementById('option_c').value = q.option_c;
        document.getElementById('option_d').value = q.option_d;
        document.getElementById('correct_option').value = q.correct_option;
      }

      async function deleteQuestion(id) {
        if (!confirm('Are you sure you want to delete this question?')) return;
        await fetch(`/api/questions/${id}`, { method: 'DELETE' });
        loadQuestions();
      }

      document.getElementById('questionForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const id = document.getElementById('questionId').value;
        const question = {
          sub: document.getElementById('sub').value,
          qno: document.getElementById('qno').value,
          question_text: document.getElementById('question_text').value,
          option_a: document.getElementById('option_a').value,
          option_b: document.getElementById('option_b').value,
          option_c: document.getElementById('option_c').value,
          option_d: document.getElementById('option_d').value,
          correct_option: document.getElementById('correct_option').value
        };

        if (id) {
          await fetch(`/api/questions/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(question)
          });
        } else {
          await fetch('/api/questions', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(question)
          });
        }

        e.target.reset();
        document.getElementById('questionId').value = '';
        loadQuestions();
      });

      loadQuestions();
    </script>
  </body>
</html>
